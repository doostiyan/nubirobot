import datetime
from decimal import Decimal
from unittest import TestCase
from unittest.mock import Mock

from exchange.base.models import Currencies
from exchange.blockchain.api.bnb.binance import BinanceAPI
from exchange.blockchain.api.bnb.bnbchain import Bnbchain
from exchange.blockchain.staking.staking_interface import StakingInterface
from exchange.blockchain.staking.staking_models import CoinType


class TestBnbStakingInterface(TestCase):
    def test_atom_get_staking_data(self):
        address = 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9'
        staking_api = Bnbchain.get_api()
        staking_api.request = Mock()
        staking_api.request.side_effect = [
                    {'delegated': 1.3, 'unbonding': 0, 'asset': 'BNB'},
                    {'total': 15, 'rewardDetails': [{'id': 34116597, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00013033, 'height': 294555118, 'rewardTime': '2023-02-04T00:00:00.000+00:00'}, {'id': 34067100, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012552, 'height': 294349888, 'rewardTime': '2023-02-03T00:00:00.000+00:00'}, {'id': 34014760, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011665, 'height': 294144914, 'rewardTime': '2023-02-02T00:00:00.000+00:00'}, {'id': 33958286, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00014416, 'height': 293938579, 'rewardTime': '2023-02-01T00:00:00.000+00:00'}, {'id': 33913520, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012207, 'height': 293732529, 'rewardTime': '2023-01-31T00:00:00.000+00:00'}, {'id': 33854824, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010354, 'height': 293527357, 'rewardTime': '2023-01-30T00:00:00.000+00:00'}, {'id': 33813753, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010745, 'height': 293321603, 'rewardTime': '2023-01-29T00:00:00.000+00:00'}, {'id': 33754960, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010574, 'height': 293115648, 'rewardTime': '2023-01-28T00:00:00.000+00:00'}, {'id': 33697187, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010244, 'height': 292910609, 'rewardTime': '2023-01-27T00:00:00.000+00:00'}, {'id': 33662210, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010315, 'height': 292706042, 'rewardTime': '2023-01-26T00:00:00.000+00:00'}, {'id': 33611530, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.691e-05, 'height': 292502051, 'rewardTime': '2023-01-25T00:00:00.000+00:00'}, {'id': 33560353, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.676e-05, 'height': 292299787, 'rewardTime': '2023-01-24T00:00:00.000+00:00'}, {'id': 33499795, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012886, 'height': 292096762, 'rewardTime': '2023-01-23T00:00:00.000+00:00'}, {'id': 33459580, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011303, 'height': 291892969, 'rewardTime': '2023-01-22T00:00:00.000+00:00'}, {'id': 33388609, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.843e-05, 'height': 291688404, 'rewardTime': '2023-01-21T00:00:00.000+00:00'}]}
                ]

        balance_api = BinanceAPI.get_api()
        balance_api.request = Mock()
        balance_api.request.side_effect = [
            {'account_number': 7373415, 'address': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'balances': [{'free': '0.10149504', 'frozen': '0.00000000', 'locked': '0.00000000', 'symbol': 'BNB'}], 'flags': 0, 'public_key': [2, 20, 115, 4, 236, 208, 104, 228, 40, 57, 48, 128, 149, 77, 156, 138, 94, 161, 74, 150, 153, 171, 203, 224, 217, 49, 68, 164, 28, 58, 0, 224, 27], 'sequence': 1},
        ]
        start_date = datetime.datetime(2023, 1, 21)
        end_date = datetime.datetime(2023, 4, 30)
        staking_info = StakingInterface.get_info(network='BNB', address=address, currency=Currencies.bnb,
                                                 start_reward_period=start_date, end_reward_period=end_date)
        assert staking_info.address == 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9'
        assert staking_info.rewards_balance == Decimal('0.00169504')
        assert staking_info.staked_balance == Decimal('1.3')
        assert staking_info.delegated_balance == Decimal('1.3')
        assert staking_info.free_balance == Decimal('0.10149504')
        assert staking_info.total_balance == Decimal('1.40149504')
        assert staking_info.coin_type == CoinType.PERIODIC_REWARD

    def test_atom_get_staking_data_dated(self):
        address = 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9'
        staking_api = Bnbchain.get_api()
        staking_api.request = Mock()
        staking_api.request.side_effect = [
                    {'delegated': 1.3, 'unbonding': 0, 'asset': 'BNB'},
                    {'total': 57, 'rewardDetails': [{'id': 36242157, 'chainId': 'bsc', 'validator': 'bva1lup0myq4xqu0ze0ng92w69jqwd2qqycxc76v2r', 'valName': 'Legend V - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011243, 'height': 303122586, 'rewardTime': '2023-03-18T00:00:00.000+00:00'}, {'id': 36191200, 'chainId': 'bsc', 'validator': 'bva1lup0myq4xqu0ze0ng92w69jqwd2qqycxc76v2r', 'valName': 'Legend V - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010209, 'height': 302917012, 'rewardTime': '2023-03-17T00:00:00.000+00:00'}, {'id': 36140356, 'chainId': 'bsc', 'validator': 'bva1lup0myq4xqu0ze0ng92w69jqwd2qqycxc76v2r', 'valName': 'Legend V - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010384, 'height': 302712622, 'rewardTime': '2023-03-16T00:00:00.000+00:00'}, {'id': 36091186, 'chainId': 'bsc', 'validator': 'bva1lup0myq4xqu0ze0ng92w69jqwd2qqycxc76v2r', 'valName': 'Legend V - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.839e-05, 'height': 302507483, 'rewardTime': '2023-03-15T00:00:00.000+00:00'}, {'id': 36040699, 'chainId': 'bsc', 'validator': 'bva1lup0myq4xqu0ze0ng92w69jqwd2qqycxc76v2r', 'valName': 'Legend V - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010057, 'height': 302302573, 'rewardTime': '2023-03-14T00:00:00.000+00:00'}, {'id': 35991982, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00017208, 'height': 302098851, 'rewardTime': '2023-03-13T00:00:00.000+00:00'}, {'id': 35941925, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012825, 'height': 301895601, 'rewardTime': '2023-03-12T00:00:00.000+00:00'}, {'id': 35890889, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012643, 'height': 301693686, 'rewardTime': '2023-03-11T00:00:00.000+00:00'}, {'id': 35841571, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00019877, 'height': 301492010, 'rewardTime': '2023-03-10T00:00:00.000+00:00'}, {'id': 35791394, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00015773, 'height': 301289631, 'rewardTime': '2023-03-09T00:00:00.000+00:00'}, {'id': 35741934, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00021809, 'height': 301086992, 'rewardTime': '2023-03-08T00:00:00.000+00:00'}, {'id': 35691700, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00015087, 'height': 300884430, 'rewardTime': '2023-03-07T00:00:00.000+00:00'}, {'id': 35640872, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00017667, 'height': 300681914, 'rewardTime': '2023-03-06T00:00:00.000+00:00'}, {'id': 35591191, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00026559, 'height': 300478996, 'rewardTime': '2023-03-05T00:00:00.000+00:00'}, {'id': 35540491, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00028597, 'height': 300275638, 'rewardTime': '2023-03-04T00:00:00.000+00:00'}, {'id': 35490186, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00029893, 'height': 300073889, 'rewardTime': '2023-03-03T00:00:00.000+00:00'}, {'id': 35440327, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00055794, 'height': 299870901, 'rewardTime': '2023-03-02T00:00:00.000+00:00'}, {'id': 35389417, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.0003167, 'height': 299668032, 'rewardTime': '2023-03-01T00:00:00.000+00:00'}, {'id': 35339120, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00013156, 'height': 299464764, 'rewardTime': '2023-02-28T00:00:00.000+00:00'}, {'id': 35289307, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012481, 'height': 299261664, 'rewardTime': '2023-02-27T00:00:00.000+00:00'}, {'id': 35238697, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00017605, 'height': 299057763, 'rewardTime': '2023-02-26T00:00:00.000+00:00'}, {'id': 35188235, 'chainId': 'bsc', 'validator': 'bva1we4frydjkyejdzp506gzpljaqpqu5fs0flu60p', 'valName': 'Legend IV - Alternate', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00018044, 'height': 298853879, 'rewardTime': '2023-02-25T00:00:00.000+00:00'}, {'id': 35118751, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012927, 'height': 298650109, 'rewardTime': '2023-02-24T00:00:00.000+00:00'}, {'id': 35077879, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00013006, 'height': 298446245, 'rewardTime': '2023-02-23T00:00:00.000+00:00'}, {'id': 35027734, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00013102, 'height': 298242449, 'rewardTime': '2023-02-22T00:00:00.000+00:00'}, {'id': 34976550, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011505, 'height': 298038628, 'rewardTime': '2023-02-21T00:00:00.000+00:00'}, {'id': 34912681, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.0001112, 'height': 297833259, 'rewardTime': '2023-02-20T00:00:00.000+00:00'}, {'id': 34862270, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012615, 'height': 297626516, 'rewardTime': '2023-02-19T00:00:00.000+00:00'}, {'id': 34810848, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.0001309, 'height': 297419676, 'rewardTime': '2023-02-18T00:00:00.000+00:00'}, {'id': 34760969, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012428, 'height': 297219171, 'rewardTime': '2023-02-17T00:00:00.000+00:00'}, {'id': 34715731, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010465, 'height': 297017932, 'rewardTime': '2023-02-16T00:00:00.000+00:00'}, {'id': 34658584, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012107, 'height': 296817638, 'rewardTime': '2023-02-15T00:00:00.000+00:00'}, {'id': 34616518, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010743, 'height': 296611139, 'rewardTime': '2023-02-14T00:00:00.000+00:00'}, {'id': 34556177, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011551, 'height': 296405322, 'rewardTime': '2023-02-13T00:00:00.000+00:00'}, {'id': 34506363, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010558, 'height': 296200054, 'rewardTime': '2023-02-12T00:00:00.000+00:00'}, {'id': 34465260, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012205, 'height': 295994582, 'rewardTime': '2023-02-11T00:00:00.000+00:00'}, {'id': 34414697, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011286, 'height': 295789973, 'rewardTime': '2023-02-10T00:00:00.000+00:00'}, {'id': 34363988, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012132, 'height': 295584089, 'rewardTime': '2023-02-09T00:00:00.000+00:00'}, {'id': 34301919, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010984, 'height': 295378766, 'rewardTime': '2023-02-08T00:00:00.000+00:00'}, {'id': 34262539, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011352, 'height': 295173486, 'rewardTime': '2023-02-07T00:00:00.000+00:00'}, {'id': 34201675, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012521, 'height': 294969180, 'rewardTime': '2023-02-06T00:00:00.000+00:00'}, {'id': 34167170, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011613, 'height': 294761818, 'rewardTime': '2023-02-05T00:00:00.000+00:00'}, {'id': 34116597, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00013033, 'height': 294555118, 'rewardTime': '2023-02-04T00:00:00.000+00:00'}, {'id': 34067100, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012552, 'height': 294349888, 'rewardTime': '2023-02-03T00:00:00.000+00:00'}, {'id': 34014760, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011665, 'height': 294144914, 'rewardTime': '2023-02-02T00:00:00.000+00:00'}, {'id': 33958286, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00014416, 'height': 293938579, 'rewardTime': '2023-02-01T00:00:00.000+00:00'}, {'id': 33913520, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012207, 'height': 293732529, 'rewardTime': '2023-01-31T00:00:00.000+00:00'}, {'id': 33854824, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010354, 'height': 293527357, 'rewardTime': '2023-01-30T00:00:00.000+00:00'}, {'id': 33813753, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010745, 'height': 293321603, 'rewardTime': '2023-01-29T00:00:00.000+00:00'}, {'id': 33754960, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010574, 'height': 293115648, 'rewardTime': '2023-01-28T00:00:00.000+00:00'}, {'id': 33697187, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010244, 'height': 292910609, 'rewardTime': '2023-01-27T00:00:00.000+00:00'}, {'id': 33662210, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00010315, 'height': 292706042, 'rewardTime': '2023-01-26T00:00:00.000+00:00'}, {'id': 33611530, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.691e-05, 'height': 292502051, 'rewardTime': '2023-01-25T00:00:00.000+00:00'}, {'id': 33560353, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.676e-05, 'height': 292299787, 'rewardTime': '2023-01-24T00:00:00.000+00:00'}, {'id': 33499795, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00012886, 'height': 292096762, 'rewardTime': '2023-01-23T00:00:00.000+00:00'}, {'id': 33459580, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 0.00011303, 'height': 291892969, 'rewardTime': '2023-01-22T00:00:00.000+00:00'}, {'id': 33388609, 'chainId': 'bsc', 'validator': 'bva1c6aqe9ndzcn2nsan963z43xg6kgrvzynl97785', 'valName': 'TW Staking', 'delegator': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'reward': 9.843e-05, 'height': 291688404, 'rewardTime': '2023-01-21T00:00:00.000+00:00'}]}
                ]
        balance_api = BinanceAPI.get_api()
        balance_api.request = Mock()
        balance_api.request.side_effect = [
            {'account_number': 7373415, 'address': 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9', 'balances': [{'free': '0.10685234', 'frozen': '0.00000000', 'locked': '0.00000000', 'symbol': 'BNB'}], 'flags': 0, 'public_key': [2, 20, 115, 4, 236, 208, 104, 228, 40, 57, 48, 128, 149, 77, 156, 138, 94, 161, 74, 150, 153, 171, 203, 224, 217, 49, 68, 164, 28, 58, 0, 224, 27], 'sequence': 3},
        ]

        staking_info = StakingInterface.get_info(network='BNB', address=address, currency=Currencies.bnb,
                                                 start_reward_period=datetime.date(2023, 3, 13),
                                                 end_reward_period=datetime.date(2023, 3, 15))
        assert staking_info.address == 'bnb1n75v3v6ssk4e5uqrtuk09vlz4n32r9vs270qh9'
        assert staking_info.rewards_balance == Decimal('0.00037104')
        assert staking_info.staked_balance == Decimal('1.3')
        assert staking_info.delegated_balance == Decimal('1.3')
        assert staking_info.free_balance == Decimal('0.10685234')
        assert staking_info.total_balance == Decimal('1.40685234')
        assert staking_info.coin_type == CoinType.PERIODIC_REWARD
