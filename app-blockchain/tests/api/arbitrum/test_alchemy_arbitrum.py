from decimal import Decimal
from unittest import TestCase
from unittest.mock import Mock

import pytest
from django.conf import settings
from django.core.cache import cache
from hexbytes import HexBytes

from exchange.blockchain.utils import BlockchainUtilsMixin

if settings.BLOCKCHAIN_CACHE_PREFIX == 'cold_':
    from wallet.models import CURRENCIES as Currencies
else:
    from exchange.base.models import Currencies

from exchange.blockchain.api.arbitrum.alchemy_arbitrum import AlchemyArbitrumApi
from exchange.blockchain.api.arbitrum.arbitrum_explorer_interface import ArbitrumExplorerInterface
from exchange.blockchain.explorer_original import BlockchainExplorer


@pytest.mark.slow
class TestAlchemyArbitrumApiCalls(TestCase):
    api = AlchemyArbitrumApi.get_instance()

    addresses = ['0x73EbF040cb59F60c6bf7a43A44D092710bef621A',
                 '0x7Ade75Da6940929482E986FBb08b6Cd02fCE96E9']

    addresses_for_usdt = ['0x2370854a6e5e71eb8e5c4198fb8c24b1968c9efa']

    txs_hash = ['0x713c3d4fd942af2e842f298f04122a0c5c897b6b21d03857ec3321d741d8b7ed',
                '0xe9a44ca0907f45d64c3de354df0f85f4ee1625147e64a4baab16c664eaa140ef',
                '0x18f0380b8914aaa15069ac60a32929a458ae3e56903e6848ef56aab91e02b7b1',
                '0x1c204205e5eaa47a87b27fe17a9dc998af5293beab88084d726cf793312b8feb']

    contracts_info = {'address': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', 'decimal': 6}

    transaction_important_fields = {'input', 'value', 'from', 'to', 'hash', 'blockNumber'}

    def test_get_balance_api(self):
        for address in self.addresses:
            get_balance_result = self.api.get_balance(address)
            assert type(get_balance_result) == int

    def test_get_block_head_api(self):
        get_block_head_response = self.api.get_block_head()
        assert type(get_block_head_response) == int

    def test_get_tx_details_api(self):
        for tx_hash in self.txs_hash:
            get_tx_details_response = self.api.get_tx_details(tx_hash)
            assert self.transaction_important_fields.issubset(set(get_tx_details_response.keys()))

    def test_get_tx_receipt(self):
        for tx_hash in self.txs_hash:
            get_tx_receipt_response = self.api.get_tx_receipt(tx_hash)
            assert {'status'}.issubset(get_tx_receipt_response.keys())

    def test_get_block_txs_api(self):
        get_block_txs_response = self.api.get_block_txs(93844881)
        assert {'transactions'}.issubset(get_block_txs_response.keys())
        for transaction in get_block_txs_response.get('transactions'):
            assert self.transaction_important_fields.issubset(transaction.keys())

    def test_get_token_balance_api(self):
        for address in self.addresses_for_usdt:
            get_balance_result = self.api.get_token_balance(address, contract_info=self.contracts_info)
            assert type(get_balance_result) == int


class TestAlchemyArbitrumFromExplorer(TestCase):
    api = AlchemyArbitrumApi

    addresses = ['0x73EbF040cb59F60c6bf7a43A44D092710bef621A',
                 '0x7Ade75Da6940929482E986FBb08b6Cd02fCE96E9']

    addresses_for_usdt = ['0x2370854a6e5e71eb8e5c4198fb8c24b1968c9efa']

    txs_hash = ['0x713c3d4fd942af2e842f298f04122a0c5c897b6b21d03857ec3321d741d8b7ed',
                '0xe9a44ca0907f45d64c3de354df0f85f4ee1625147e64a4baab16c664eaa140ef',
                '0x18f0380b8914aaa15069ac60a32929a458ae3e56903e6848ef56aab91e02b7b1',
                '0x1c204205e5eaa47a87b27fe17a9dc998af5293beab88084d726cf793312b8feb']

    def test_get_balance(self):
        balance_mock_responses = [20698800000000, 2574193168345789]
        self.api.get_balance = Mock(side_effect=balance_mock_responses)
        ArbitrumExplorerInterface.balance_apis[0] = self.api
        balances = BlockchainExplorer.get_wallets_balance({'ARB': self.addresses}, Currencies.eth)
        expected_balances = [
            {'address': '0x73EbF040cb59F60c6bf7a43A44D092710bef621A', 'balance': Decimal('0.000020698800000000'),
             'received': Decimal('0.000020698800000000'), 'sent': Decimal('0'), 'rewarded': Decimal('0')},
            {'address': '0x7Ade75Da6940929482E986FBb08b6Cd02fCE96E9', 'balance': Decimal('0.002574193168345789'),
             'received': Decimal('0.002574193168345789'), 'sent': Decimal('0'), 'rewarded': Decimal('0')}]
        for balance, expected_balance in zip(balances.get(Currencies.eth), expected_balances):
            assert balance == expected_balance

    def test_get_tx_details(self):
        tx_details_mock_responses = [
            {'blockHash': HexBytes('0xa0c61959964369233483da10c74eb0d171028a9b648d9f5ee55f3bab403cba3a'),
             'blockNumber': 68980236,
             'hash': HexBytes('0xe9a44ca0907f45d64c3de354df0f85f4ee1625147e64a4baab16c664eaa140ef'),
             'chainId': '0xa4b1', 'from': '0x89537dd46285292c8d46f884d7De757526AcC348', 'gas': 382285,
             'gasPrice': 105000000, 'input': HexBytes('0x'), 'nonce': 9,
             'r': HexBytes('0x86af3c3d46396ffb39c9ad6f67fe218f6ec9510bcbfb22beec8db78f665f5c40'),
             's': HexBytes('0x5907b57e0f77261f34db9b139cb7060da5b763bc9fcf5ef5f4220e5d53f75787'),
             'to': '0x0F6304Cbfa1C1b2b0Cd0c896739925665dC3a7D7', 'transactionIndex': 1, 'type': '0x0', 'v': 84358,
             'value': 9932173804348623},
            {'blockHash': HexBytes('0x8b208c53f81b9f48e248085d3a1337fbc41dd1f103ad0abb0a961bdb559e58e8'),
             'blockNumber': 85767850,
             'hash': HexBytes('0x18f0380b8914aaa15069ac60a32929a458ae3e56903e6848ef56aab91e02b7b1'),
             'chainId': '0xa4b1', 'from': '0xcE2C449Ec9CfCb3511c0284b7892F48B71B58e24', 'gas': 1238020,
             'gasPrice': 100000000,
             'input': HexBytes('0x095ea7b3000000000000000000000000908c4d94d34924765f1edc22a1dd098397c59dd400000000000000000000000000000000000000000000000000175cd59b9649b1'),
             'nonce': 5, 'r': HexBytes('0xdc1b2a1dcc00fee66bfddce18c3d2e632e4764ba8018db0f3c2eb053e1176591'),
             's': HexBytes('0x3a473ab3f244459088da2cec93e7ccba83462f2fd0eeeb55ddd195c4bfe2bab1'),
             'to': '0xfc5A1A6EB076a2C7aD06eD22C90d7E710E35ad0a', 'transactionIndex': 2, 'type': '0x0', 'v': 84358,
             'value': 0},
            {'blockHash': HexBytes('0x45ec838e53be8b361c686acf1b7d3e81d268e4f7de9403ff127c77b468e897ad'),
             'blockNumber': 93518603,
             'hash': HexBytes('0x1c204205e5eaa47a87b27fe17a9dc998af5293beab88084d726cf793312b8feb'),
             'chainId': '0xa4b1', 'from': '0x85E623F998649347Abfc6854f81269F5C199109c', 'gas': 1268463,
             'gasPrice': 110000000,
             'input': HexBytes('0xa9059cbb000000000000000000000000a87dbce39777284df5a6924eefee1cdd52be759e000000000000000000000000000000000000000000000000000000000e4e1c00'),
             'nonce': 1477, 'r': HexBytes('0x27de303e21479398379c63c81f1d5a8bba23ebd4e085127902be4723e7072371'),
             's': HexBytes('0x074f2f88fa290700025810761d3723a6ff679b2e20e7398606e5d5f872a5fcd5'),
             'to': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', 'transactionIndex': 2, 'type': '0x0', 'v': 84357,
             'value': 0}]
        tx_receipt_mock_responses = [
            {'transactionHash': HexBytes('0x713c3d4fd942af2e842f298f04122a0c5c897b6b21d03857ec3321d741d8b7ed'),
             'blockHash': HexBytes('0x8e0a86390208d54cf21450b7477d48716d7c21dfdcf151c7241c0ae62495aa44'),
             'blockNumber': 80950818, 'logs': [], 'contractAddress': None, 'effectiveGasPrice': 100000000,
             'cumulativeGasUsed': 3503821, 'from': '0x8929219CD7320c6e144287c2502F0504e4369e56', 'gasUsed': 1168411,
             'logsBloom': HexBytes(
                 '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
             'status': 0, 'to': '0x5845696F6031BFd57B32e6Ce2DdeA19A486fa5e5', 'transactionIndex': 4, 'type': '0x2',
             'l1BlockNumber': '0x1044695', 'gasUsedForL1': '0x62f35'},
            {'transactionHash': HexBytes('0xe9a44ca0907f45d64c3de354df0f85f4ee1625147e64a4baab16c664eaa140ef'),
             'blockHash': HexBytes('0xa0c61959964369233483da10c74eb0d171028a9b648d9f5ee55f3bab403cba3a'),
             'blockNumber': 68980236, 'logs': [], 'contractAddress': None, 'effectiveGasPrice': 100000000,
             'cumulativeGasUsed': 275950, 'from': '0x89537dd46285292c8d46f884d7De757526AcC348', 'gasUsed': 275950,
             'logsBloom': HexBytes(
                 '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
             'status': 1, 'to': '0x0F6304Cbfa1C1b2b0Cd0c896739925665dC3a7D7', 'transactionIndex': 1, 'type': '0x0',
             'l1BlockNumber': '0x1007945', 'gasUsedForL1': '0x3e3e6'},
            {'transactionHash': HexBytes('0x18f0380b8914aaa15069ac60a32929a458ae3e56903e6848ef56aab91e02b7b1'),
             'blockHash': HexBytes('0x8b208c53f81b9f48e248085d3a1337fbc41dd1f103ad0abb0a961bdb559e58e8'),
             'blockNumber': 85767850, 'logs': [
                {'transactionHash': HexBytes('0x18f0380b8914aaa15069ac60a32929a458ae3e56903e6848ef56aab91e02b7b1'),
                 'address': '0xfc5A1A6EB076a2C7aD06eD22C90d7E710E35ad0a',
                 'blockHash': HexBytes('0x8b208c53f81b9f48e248085d3a1337fbc41dd1f103ad0abb0a961bdb559e58e8'),
                 'blockNumber': 85767850, 'data': '0x00000000000000000000000000000000000000000000000000175cd59b9649b1',
                 'logIndex': 4, 'removed': False,
                 'topics': [HexBytes('0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925'),
                            HexBytes('0x000000000000000000000000ce2c449ec9cfcb3511c0284b7892f48b71b58e24'),
                            HexBytes('0x000000000000000000000000908c4d94d34924765f1edc22a1dd098397c59dd4')],
                 'transactionIndex': 2}], 'contractAddress': None, 'effectiveGasPrice': 100000000,
             'cumulativeGasUsed': 2478021, 'from': '0xcE2C449Ec9CfCb3511c0284b7892F48B71B58e24', 'gasUsed': 596602,
             'logsBloom': HexBytes(
                 '0x00000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000001000000000000000000000000200400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000080000000002000004000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000002000000000000000000'),
             'status': 1, 'to': '0xfc5A1A6EB076a2C7aD06eD22C90d7E710E35ad0a', 'transactionIndex': 2, 'type': '0x0',
             'l1BlockNumber': '0x105ccb4', 'gasUsedForL1': '0x8662f'},
            {'transactionHash': HexBytes('0x1c204205e5eaa47a87b27fe17a9dc998af5293beab88084d726cf793312b8feb'),
             'blockHash': HexBytes('0x45ec838e53be8b361c686acf1b7d3e81d268e4f7de9403ff127c77b468e897ad'),
             'blockNumber': 93518603, 'logs': [
                {'transactionHash': HexBytes('0x1c204205e5eaa47a87b27fe17a9dc998af5293beab88084d726cf793312b8feb'),
                 'address': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                 'blockHash': HexBytes('0x45ec838e53be8b361c686acf1b7d3e81d268e4f7de9403ff127c77b468e897ad'),
                 'blockNumber': 93518603, 'data': '0x000000000000000000000000000000000000000000000000000000000e4e1c00',
                 'logIndex': 0, 'removed': False,
                 'topics': [HexBytes('0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef'),
                            HexBytes('0x00000000000000000000000085e623f998649347abfc6854f81269f5c199109c'),
                            HexBytes('0x000000000000000000000000a87dbce39777284df5a6924eefee1cdd52be759e')],
                 'transactionIndex': 2}], 'contractAddress': None, 'effectiveGasPrice': 100000000,
             'cumulativeGasUsed': 1053518, 'from': '0x85E623F998649347Abfc6854f81269F5C199109c', 'gasUsed': 666109,
             'logsBloom': HexBytes(
                 '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000020000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000040010000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000001000000008002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000008000000'),
             'status': 1, 'to': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', 'transactionIndex': 2, 'type': '0x0',
             'l1BlockNumber': '0x108490f', 'gasUsedForL1': '0x93b97'}]
        block_head_mock_responses = [85799976, 85800270, 93518603]
        self.api.get_tx_details = Mock(side_effect=tx_details_mock_responses)
        self.api.get_tx_receipt = Mock(side_effect=tx_receipt_mock_responses)
        self.api.get_block_head = Mock(side_effect=block_head_mock_responses)
        ArbitrumExplorerInterface.tx_details_apis[0] = self.api
        txs_details = BlockchainExplorer.get_transactions_details(self.txs_hash, 'ARB')
        expected_txs_details = [{'success': False},
                                {
                                    'success': True, 'block': 68980236, 'date': None,
                                    'raw': None,
                                    'inputs': [], 'outputs': [],
                                    'transfers': [{
                                        'type': 'MainCoin', 'symbol': 'ETH', 'currency': 11,
                                        'to': '0x0f6304cbfa1c1b2b0cd0c896739925665dc3a7d7',
                                        'value': Decimal('0.009932173804348623'), 'is_valid': True, 'token': None,'memo': None,
                                        'from': '0x89537dd46285292c8d46f884d7de757526acc348'
                                    }],
                                    'fees': None, 'memo': None, 'confirmations': 16819740,
                                    'hash': '0xe9a44ca0907f45d64c3de354df0f85f4ee1625147e64a4baab16c664eaa140ef'
                                },
                                {'success': False},
                                {'success': True, 'block': 93518603, 'date': None, 'raw': None, 'inputs': [],
                                 'outputs': [], 'transfers': [{'type': 'Token', 'symbol': 'USDT', 'currency': 13,
                                                               'to': '0xa87dbce39777284df5a6924eefee1cdd52be759e',
                                                               'value': Decimal('240.000000'), 'is_valid': True,'memo': None,
                                                               'token': '0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9',
                                                               'from': '0x85e623f998649347abfc6854f81269f5c199109c'}],
                                 'fees': None, 'memo': None, 'confirmations': 0,
                                 'hash': '0x1c204205e5eaa47a87b27fe17a9dc998af5293beab88084d726cf793312b8feb'}]
        for expected_tx_details, tx_hash in zip(expected_txs_details, self.txs_hash):
            assert txs_details.get(tx_hash) == expected_tx_details

    def test_get_block_txs(self):
        cache.delete('latest_block_height_processed_arb')
        block_head_mock_response = 93844885
        block_txs_mock_responses = [
            {'number': 93844881, 'hash': HexBytes('0x84440fca05d5005119976cb479e73bee29707557d4d47588b239e03b3545df8b'),
             'transactions': [
                 {'blockHash': HexBytes('0x84440fca05d5005119976cb479e73bee29707557d4d47588b239e03b3545df8b'),
                  'blockNumber': 93844881,
                  'hash': HexBytes('0x8cfb4d003b9fb4684714496349def97516dcec98676818af94515d127192acd5'),
                  'chainId': '0xa4b1', 'from': '0x00000000000000000000000000000000000A4B05', 'gas': 0, 'gasPrice': 0,
                  'input': HexBytes('0x6bf6a42d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010863c6000000000000000000000000000000000000000000000000000000000597f5910000000000000000000000000000000000000000000000000000000000000000'),
                  'nonce': 0, 'r': HexBytes('0x00'), 's': HexBytes('0x00'),
                  'to': '0x00000000000000000000000000000000000A4B05', 'transactionIndex': 0, 'type': '0x6a', 'v': 0,
                  'value': 0},
                 {'blockHash': HexBytes('0x84440fca05d5005119976cb479e73bee29707557d4d47588b239e03b3545df8b'),
                  'blockNumber': 93844881,
                  'hash': HexBytes('0xe72c8aead1e00ef2af669ad4a8e26f2e20b38e7281410bf317f2045071f5f442'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x62383739D68Dd0F844103Db8dFb05a7EdED5BBE6',
                  'gas': 3000000, 'gasPrice': 2100000000,
                  'input': HexBytes('0xa9059cbb000000000000000000000000202e653fb198b3f6ae6f178af6425c075ddfc1ad0000000000000000000000000000000000000000000000000000000002160ec0'),
                  'maxFeePerGas': 10000000000, 'maxPriorityFeePerGas': 2000000000, 'nonce': 627323,
                  'r': HexBytes('0xda1a9900dc1faf8147c64d16215ab8a89bb970c554c783801a4d5a44d309f30d'),
                  's': HexBytes('0x407654ae0c400607ad52527323cf688ddd7af373659626b535f02f357f6585a4'),
                  'to': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', 'transactionIndex': 1, 'type': '0x2', 'v': 1,
                  'value': 0},
                 {'blockHash': HexBytes('0x84440fca05d5005119976cb479e73bee29707557d4d47588b239e03b3545df8b'),
                  'blockNumber': 93844881,
                  'hash': HexBytes('0xda8b725a6b60b3da15ad669086faa39f946d28ddf03fd3db7eac27e6d329b0fa'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0xf92402bB795Fd7CD08fb83839689DB79099C8c9C',
                  'gas': 497579, 'gasPrice': 1200000000, 'input': HexBytes('0x'), 'maxFeePerGas': 1200000000,
                  'maxPriorityFeePerGas': 2000000000, 'nonce': 265574,
                  'r': HexBytes('0x158ef859cbdfc930c332a2b0ca5cb333f2aedef77d6a577494fceb350422aee1'),
                  's': HexBytes('0x4313fdcc6c037c2f29738679f228b0f59f5ac34d8dc8a13d35bf5bb6b625fc6f'),
                  'to': '0xcCA39e63EF650a3fb9B2a0E7e50Bd5CFBc198880', 'transactionIndex': 2, 'type': '0x2', 'v': 1,
                  'value': 12442000000000000}], 'difficulty': 1,
             'extraData': HexBytes('0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'),
             'gasLimit': 1125899906842624, 'gasUsed': 995300, 'logsBloom': HexBytes(
                '0x00000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008002000000000000000000000000000000000000000000000000000000020000000040000000000000008000000010000000000000000000000000000040'),
             'miner': '0xA4b000000000000000000073657175656e636572',
             'mixHash': HexBytes('0x0000000000012c6600000000010863c6000000000000000a0000000000000000'),
             'nonce': HexBytes('0x00000000000d3ed6'),
             'parentHash': HexBytes('0xc339a203177291b50bd368b174294508b47cf6f3603250e3b03a4c09d33013af'),
             'receiptsRoot': HexBytes('0x37671ff9d3ed24358906ecd50db505fcb1f5e2fc25d94df2e1214a4d48cd6433'),
             'sha3Uncles': HexBytes('0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347'), 'size': 1011,
             'stateRoot': HexBytes('0x08e024326485db44d0029e018eff45d08daf2e4231f981dc18a8cfde464aaf4d'),
             'timestamp': 1684906962, 'totalDifficulty': 71637065,
             'transactionsRoot': HexBytes('0x77f21c20741cd81f8fd113fd8ea790d9203611295149ebe4b9ede33836c1f5fd'),
             'uncles': [], 'baseFeePerGas': 100000000, 'l1BlockNumber': '0x10863c6', 'sendCount': '0x12c66',
             'sendRoot': '0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'},
            {'number': 93844882, 'hash': HexBytes('0xa7857736ee460c2b4e1ffd4c093b2880efa0cb31b0433c42354b40580cedf7d8'),
             'transactions': [
                 {'blockHash': HexBytes('0xa7857736ee460c2b4e1ffd4c093b2880efa0cb31b0433c42354b40580cedf7d8'),
                  'blockNumber': 93844882,
                  'hash': HexBytes('0xa25e12c94b19f9363cb1dac5fc8bfdd4c060fbb927c1a9bca2c0adadbfcc8733'),
                  'chainId': '0xa4b1', 'from': '0x00000000000000000000000000000000000A4B05', 'gas': 0, 'gasPrice': 0,
                  'input': HexBytes('0x6bf6a42d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010863c6000000000000000000000000000000000000000000000000000000000597f5920000000000000000000000000000000000000000000000000000000000000000'),
                  'nonce': 0, 'r': HexBytes('0x00'), 's': HexBytes('0x00'),
                  'to': '0x00000000000000000000000000000000000A4B05', 'transactionIndex': 0, 'type': '0x6a', 'v': 0,
                  'value': 0},
                 {'blockHash': HexBytes('0xa7857736ee460c2b4e1ffd4c093b2880efa0cb31b0433c42354b40580cedf7d8'),
                  'blockNumber': 93844882,
                  'hash': HexBytes('0x1573594194318decf7ab73fca06a081c62164fb1827ef8a98979bc9b34228c77'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x1B5B4e441F5A22bfd91B7772C780463F66A74b35',
                  'gas': 497579, 'gasPrice': 1200000000, 'input': HexBytes('0x'), 'maxFeePerGas': 1200000000,
                  'maxPriorityFeePerGas': 2000000000, 'nonce': 275787,
                  'r': HexBytes('0xe10820496dad28ff24dc94cc6499320aa8798b76c6f5f2fd6d65c26d36ec9279'),
                  's': HexBytes('0x401afd32ce00312aa9554f45dac98a0f8bb5155f7ff882a7f68f97f5454ae7a6'),
                  'to': '0xfc659535eC5f8989884e1FE074dC7887D138945B', 'transactionIndex': 1, 'type': '0x2', 'v': 0,
                  'value': 8539100000000000}], 'difficulty': 1,
             'extraData': HexBytes('0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'),
             'gasLimit': 1125899906842624, 'gasUsed': 386303, 'logsBloom': HexBytes(
                '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
             'miner': '0xA4b000000000000000000073657175656e636572',
             'mixHash': HexBytes('0x0000000000012c6600000000010863c6000000000000000a0000000000000000'),
             'nonce': HexBytes('0x00000000000d3ed6'),
             'parentHash': HexBytes('0x84440fca05d5005119976cb479e73bee29707557d4d47588b239e03b3545df8b'),
             'receiptsRoot': HexBytes('0x542979beeb18ab000b6143a9fd8cba47fede1f2d1f502c118130ee1b172af926'),
             'sha3Uncles': HexBytes('0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347'), 'size': 824,
             'stateRoot': HexBytes('0xf894a910c6ca2e13a9b3ea3fa6fe320580d38d4800537dd97dbbec271a9a6496'),
             'timestamp': 1684906962, 'totalDifficulty': 71637066,
             'transactionsRoot': HexBytes('0xff7dc08ca800f481918ff71f8d240bdcbdb6cd01fe797c48c60bb2087936010c'),
             'uncles': [], 'baseFeePerGas': 100000000, 'l1BlockNumber': '0x10863c6', 'sendCount': '0x12c66',
             'sendRoot': '0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'},
            {'number': 93844883, 'hash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
             'transactions': [
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0x0606b38d98c60fe96f7d698d87d7dd747e9228a443f993bbb7393129edafde41'),
                  'chainId': '0xa4b1', 'from': '0x00000000000000000000000000000000000A4B05', 'gas': 0, 'gasPrice': 0,
                  'input': HexBytes('0x6bf6a42d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010863c6000000000000000000000000000000000000000000000000000000000597f5930000000000000000000000000000000000000000000000000000000000000000'),
                  'nonce': 0, 'r': HexBytes('0x00'), 's': HexBytes('0x00'),
                  'to': '0x00000000000000000000000000000000000A4B05', 'transactionIndex': 0, 'type': '0x6a', 'v': 0,
                  'value': 0},
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0x275f1cc09f524528f1a2853b58fc34f5cc2a1e27e77e9c104b6e96cb1c127218'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x62383739D68Dd0F844103Db8dFb05a7EdED5BBE6',
                  'gas': 3000000, 'gasPrice': 2100000000,
                  'input': HexBytes('0xa9059cbb000000000000000000000000d888862600bf4bea4c0743a7806f32030d4dbe2c000000000000000000000000000000000000000000000000000000004b44eea5'),
                  'maxFeePerGas': 10000000000, 'maxPriorityFeePerGas': 2000000000, 'nonce': 627324,
                  'r': HexBytes('0x74d23dd498c3e844e94325145ef285b887dee5811687d601363f76ec58624247'),
                  's': HexBytes('0x513c0752c63e10eb15860820c5258ba103ffd3573d5a9b6becf2f66c2ea30cc4'),
                  'to': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', 'transactionIndex': 1, 'type': '0x2', 'v': 1,
                  'value': 0},
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0xd9642ac206288358443ad8ba2ff3ee9d40b78c2543b2501506820e09a72dd27f'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x657Ffb00c4B1F316020E4B785f7f98993765767d',
                  'gas': 2709938, 'gasPrice': 100000000,
                  'input': HexBytes('0x06e75722000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000006694340fc020c5e6b96567843da2df01b2ce1eb60000000000000000000000000000000000000000000000000001f438daa0600000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000163d61388b3f2a00000000000000000000000000657ffb00c4b1f316020e4b785f7f98993765767d000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000001742264ea4ccfd0f25d310bb8a0c92b2eb7c20b000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000124ef5dab3a0000000000000000000000000000000000000000000000000001f438daa06000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000082af49447d8a07e3bd95bd0d56f35241523fbab10000000000000000000000006694340fc020c5e6b96567843da2df01b2ce1eb600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000bb800000000000000000000000000000000000000000000000000000000'),
                  'maxFeePerGas': 135000000, 'maxPriorityFeePerGas': 0, 'nonce': 15,
                  'r': HexBytes('0xf9b4da509953edfec984c78d22deb9e3ca1cf36604ec7bda9ccbe3d1d3bb8408'),
                  's': HexBytes('0x55f39df1e594d723cb3eb1ee09863257db3b2057508d3498a4ee28f512851576'),
                  'to': '0x5543550d65813c1Fa76242227CbBA0A28a297771', 'transactionIndex': 2, 'type': '0x2', 'v': 1,
                  'value': 550000000000000},
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0xbc3a459d3d070d9887b06bbb431ee82536aaddf552014292b2c68cf80918dd28'),
                  'chainId': '0xa4b1', 'from': '0xD504bA43Be808059e9896Bfc5E051745cB36a7f9', 'gas': 5023128,
                  'gasPrice': 100000000, 'input': HexBytes('0x99e4ef59'), 'nonce': 5123,
                  'r': HexBytes('0xb4ec16be4093028eeafcc645824e8095bf0e26dc7307ba18c160cead310953'),
                  's': HexBytes('0x55a674400c0be1f539c13885c2b334de29627f45ae5625598aca011a078c3ad4'),
                  'to': '0xb840285C49714861811B7419597717AA7517cb0d', 'transactionIndex': 3, 'type': '0x0', 'v': 84358,
                  'value': 0},
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0x531a43c29c2af8fb1ac6de67cc710aa4acecb3388ea488c0410c6e63978d4563'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x82b43Ee2e45E663Ab5040A464B85C88A88A44a20',
                  'gas': 1527625, 'gasPrice': 100000000,
                  'input': HexBytes('0x65749c9d00000000000000000000000082b43ee2e45e663ab5040a464b85c88a88a44a2000000000000000000000000000000000000000000000000000000000000000010000000000000000000000003ea9b0ab55f34fb188824ee288ceaefc63cf908e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a303fe4b530000000000000000000000000000000000000000000000000000029583e9d92d800000000000000000000000000000000000000000000000000000000000646da622'),
                  'maxFeePerGas': 135000000, 'maxPriorityFeePerGas': 0, 'nonce': 1373,
                  'r': HexBytes('0xcc91b1f151f23d08935b40d9a3c53befb060be2ceafaa39d501653c646a02734'),
                  's': HexBytes('0x1d13bc32b5dc7a15ec29cc61c8f7834453161d4f312c8b71e0085fa69a729ea8'),
                  'to': '0x37f9aE2e0Ea6742b9CAD5AbCfB6bBC3475b3862B', 'transactionIndex': 4, 'type': '0x2', 'v': 0,
                  'value': 190000000000000000},
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0x5680ceacde6e81fedeaa2a7d5691cef16aa301c2141ce997d70b6c314abf2962'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x8b52F59326AF238eE7EcA90ab4E09d245735230a',
                  'gas': 4470528, 'gasPrice': 100000000,
                  'input': HexBytes('0x56633e3e000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000003200000000000000000000000008b52f59326af238ee7eca90ab4e09d245735230a00000000000000000000000000000000000000000000000000000000000014130000000000000000000000000000000000000000000000000000000000000089000000000000000000000000ff970a61a04b1ca14834a43f5de4533ebddb5cc80000000000000000000000000000000000000000000000000000003483bc53380000000000000000000000000000000000000000000000000000a229e6b6626b0000000000000000000000002967e7bb9daa5711ac332caf874bd47ef99b3820000000000000000000000000000000000000000000000000000000000000068000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000039a7f873000000000000000000000000000000000000000000000000000000000000002001e91e80248bf27ac7a42112cc61f69e00000000646da39203cf603d66232b0400000000000000000000000000000000000000000000000000000000000000148b52f59326af238ee7eca90ab4e09d245735230a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000014fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb900000000000000000000000000000000000000000000000000000000000000000000000000000000000000148f3cf7ad23cd3cadbd9735aff958023239c6a0630000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000039a7f87300000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000014e592427a0aece92de3edee1f18e0157c058615640000000000000000000000000000000000000000000000000000000000000000000000000000000000000014e592427a0aece92de3edee1f18e0157c058615640000000000000000000000000000000000000000000000000000000000000000000000000000000000000014fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb90000000000000000000000000000000000000000000000000000000000000000000000000000000000000014ff970a61a04b1ca14834a43f5de4533ebddb5cc80000000000000000000000000000000000000000000000000000000000000000000000000000000000000124c04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000002967e7bb9daa5711ac332caf874bd47ef99b382000000000000000000000000000000000000000000000000000000000646ef5140000000000000000000000000000000000000000000000000000000039a7f8730000000000000000000000000000000000000000000000000000000039607274000000000000000000000000000000000000000000000000000000000000002bfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9000064ff970a61a04b1ca14834a43f5de4533ebddb5cc8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000014e592427a0aece92de3edee1f18e0157c058615640000000000000000000000000000000000000000000000000000000000000000000000000000000000000014e592427a0aece92de3edee1f18e0157c0586156400000000000000000000000000000000000000000000000000000000000000000000000000000000000000142791bca1f2de4661ed88a30c99a7a9449aa8417400000000000000000000000000000000000000000000000000000000000000000000000000000000000000148f3cf7ad23cd3cadbd9735aff958023239c6a0630000000000000000000000000000000000000000000000000000000000000000000000000000000000000124c04b8d59000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000002967e7bb9daa5711ac332caf874bd47ef99b382000000000000000000000000000000000000000000000000000000000646ef51e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000341c0b18d3bd67e346000000000000000000000000000000000000000000000000000000000000002b2791bca1f2de4661ed88a30c99a7a9449aa841740000648f3cf7ad23cd3cadbd9735aff958023239c6a06300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'),
                  'maxFeePerGas': 130000000, 'maxPriorityFeePerGas': 0, 'nonce': 10,
                  'r': HexBytes('0xf20075f5e55aafcfe4d9d0c15b719d2ed04402045e04278b016843314a184c87'),
                  's': HexBytes('0x2c7d1d9bf093a7fecae8de960de207b36d2a0d4223bc0f95246826b7506ded8a'),
                  'to': '0x2967E7Bb9DaA5711Ac332cAF874BD47ef99B3820', 'transactionIndex': 5, 'type': '0x2', 'v': 1,
                  'value': 178300848071275},
                 {'blockHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
                  'blockNumber': 93844883,
                  'hash': HexBytes('0xff2911e067f46cd31bc4a42fbfa6d01a21849d9ca5c515c479267fdddac9a27c'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0xB38e8c17e38363aF6EbdCb3dAE12e0243582891D',
                  'gas': 497579, 'gasPrice': 1200000000, 'input': HexBytes('0x'), 'maxFeePerGas': 1200000000,
                  'maxPriorityFeePerGas': 2000000000, 'nonce': 1229625,
                  'r': HexBytes('0x2d26fbbe25c82445040f2de8545bd2cd662e56648e03f3f4ea81732bc6cee9f6'),
                  's': HexBytes('0x7c876a690b5afc9dd9989836149c6b1c383d9a3262d4284e38d095efcd6ae8f6'),
                  'to': '0x49AA60C997F386838F1267D9b878236da9aD9d5F', 'transactionIndex': 6, 'type': '0x2', 'v': 1,
                  'value': 29250000000000000}], 'difficulty': 1,
             'extraData': HexBytes('0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'),
             'gasLimit': 1125899906842624, 'gasUsed': 6879022, 'logsBloom': HexBytes(
                '0x00006042000400180000000880000800000000000060000000000000040000184100001000080000000000000040000000084000004420000200020800200280000534010000000900000009000000080000000800040020000000820000500040000000c2240003000010040040081000000000000100400000401000082018050600000000000002000000010000008000010040000000000000540000408002000000000008000000020080102000820002020000000c080400008000000000008042000220001012000000000000000002008400200402000021220020000010280040200000004881018000020012004208000000010421000410000840'),
             'miner': '0xA4b000000000000000000073657175656e636572',
             'mixHash': HexBytes('0x0000000000012c6600000000010863c6000000000000000a0000000000000000'),
             'nonce': HexBytes('0x00000000000d3ed6'),
             'parentHash': HexBytes('0xa7857736ee460c2b4e1ffd4c093b2880efa0cb31b0433c42354b40580cedf7d8'),
             'receiptsRoot': HexBytes('0x8c62392753c2c180aae817113502ed5479bb4b80a4840a30960491fdb0c1608f'),
             'sha3Uncles': HexBytes('0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347'), 'size': 4954,
             'stateRoot': HexBytes('0xaf679bfcdc18b0fb1a58abfa4bb3e7d50c43216f4633475d39793333f0e7db74'),
             'timestamp': 1684906962, 'totalDifficulty': 71637067,
             'transactionsRoot': HexBytes('0x81bdee6e5f6b1cde0aee562d62cf96be22d9bddac48b5eaa6bfd7fc80dbc6627'),
             'uncles': [], 'baseFeePerGas': 100000000, 'l1BlockNumber': '0x10863c6', 'sendCount': '0x12c66',
             'sendRoot': '0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'},
            {'number': 93844884, 'hash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
             'transactions': [
                 {'blockHash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
                  'blockNumber': 93844884,
                  'hash': HexBytes('0xeeee5f20fb8c258d82d048d03f0d3a1df1e2a51df9072e2000ea80ccd5ae25a4'),
                  'chainId': '0xa4b1', 'from': '0x00000000000000000000000000000000000A4B05', 'gas': 0, 'gasPrice': 0,
                  'input': HexBytes('0x6bf6a42d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010863c6000000000000000000000000000000000000000000000000000000000597f5940000000000000000000000000000000000000000000000000000000000000001'),
                  'nonce': 0, 'r': HexBytes('0x00'), 's': HexBytes('0x00'),
                  'to': '0x00000000000000000000000000000000000A4B05', 'transactionIndex': 0, 'type': '0x6a', 'v': 0,
                  'value': 0},
                 {'blockHash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
                  'blockNumber': 93844884,
                  'hash': HexBytes('0xe4d2ce2c08c7fbeb2b277e90d99a7c8ea910ad6b6b3d24bb28622b958ee9dc69'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x3344D812bd21Cd5277a2F985c5293a34a193b0a7',
                  'gas': 1842857, 'gasPrice': 100000000,
                  'input': HexBytes('0x1bcfaa6600000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb900000000000000000000000000000000000000000000000000000000000f4240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001800000000000000000000000003344d812bd21cd5277a2f985c5293a34a193b0a70000000000000000000000000000000000000000000000000000000000000012373735353231363532393538383138373538000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000410a22a4c7837ddccd2f632f193ca57c183d76ff287601071faab98065f594272f37d246a1aa818f9e954d53921a2f64cc9b911af752d54f2d55d4a7583d4c0b121c00000000000000000000000000000000000000000000000000000000000000'),
                  'maxFeePerGas': 100000000, 'maxPriorityFeePerGas': 0, 'nonce': 2,
                  'r': HexBytes('0xa63797f315457501b75a28a4d1c700a0c8de06f0aa718fca93472bbe249c0d3e'),
                  's': HexBytes('0x24829d394835bafef509a855695e188a75b7038de988f7bdfc1c21a7808af26d'),
                  'to': '0x6C3F41c2D712dc1701009561af5580eFeD574C92', 'transactionIndex': 1, 'type': '0x2', 'v': 0,
                  'value': 0},
                 {'blockHash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
                  'blockNumber': 93844884,
                  'hash': HexBytes('0xbc827b593dcd79c9aea4dfd9b424b1147ce0a55b820f37d182202b067b85c4ee'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x425dE231AcD3bd847C53940fB3b65710CF4998E0',
                  'gas': 1956817, 'gasPrice': 100000000,
                  'input': HexBytes('0x95f38e770000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000425de231acd3bd847c53940fb3b65710cf4998e0000000000000000000000000ecdff76f3d9e130f795a68e50cdde5a11ec5542c0000000000000000000000000000000000000000affe9aba193a7ea5a2ec7f82000000000000000000000000000000000000000000000000000000000000000468617a7900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000430303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041754efafdb7ac280befffc321419cb9899d39b8bd819c94db1fb9f6c36c113f492895d913dd4a237823607c0aabcae12bb19b346035dff9959dd9003246ee77771b00000000000000000000000000000000000000000000000000000000000000'),
                  'maxFeePerGas': 135000000, 'maxPriorityFeePerGas': 0, 'nonce': 18,
                  'r': HexBytes('0x5b26ddef790c6c82f48cba5dc904bfe087816b270f408162391b6a883a56be00'),
                  's': HexBytes('0x4cae09fa437269f557ffa0a19dad6350bbfdb1f8822e763cc673d14f9b64c256'),
                  'to': '0x072b65F891B1a389539e921bdB9427aF41A7B1F7', 'transactionIndex': 2, 'type': '0x2', 'v': 1,
                  'value': 0},
                 {'blockHash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
                  'blockNumber': 93844884,
                  'hash': HexBytes('0x5ef790c03fc7414b108d057967541c89bcc30ddf0e3293af5e76f15a5b34394a'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x3C935902De787966b2107550460Ff3C10C0e7Fbe',
                  'gas': 2148583, 'gasPrice': 100000000,
                  'input': HexBytes('0xa44bbb1500000000000000000000000000000000000000000000000000000000000000200000000000000000000000003c935902de787966b2107550460ff3c10c0e7fbe000000000000000000000000000000000000000000000000000000000000008900000000000000000000000000000000000000000000000000000000001164e300000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff970a61a04b1ca14834a43f5de4533ebddb5cc80000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ff970a61a04b1ca14834a43f5de4533ebddb5cc800000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000100000000000000000000000000e22d2bedb3eca35e6397e0c6d62857094aa26f52000000000000000000000000000000000000000000000000000000000004974700000000000000000000000000000000000000000000000000000000000cb69b00000000000000000000000000000000000000000000000000000188705405a300000000000000000000000000000000000000000000000000000000000cb69b00000000000000000000000000000000000000000000000000000188705405a3000000000000000000000000ff970a61a04b1ca14834a43f5de4533ebddb5cc8000000000000000000000000000000000000000000000000000000000000001d'),
                  'maxFeePerGas': 100000000, 'maxPriorityFeePerGas': 100000000, 'nonce': 161,
                  'r': HexBytes('0x1de23a52adc76bb75fc14c9d1dbd0779ccb11b556e6052745e9ccbc92a16bede'),
                  's': HexBytes('0x6e1486cf2946736361eef611f2bf636a71c30cf4e406600af1227354ea2debf8'),
                  'to': '0xc30141B657f4216252dc59Af2e7CdB9D8792e1B0', 'transactionIndex': 3, 'type': '0x2', 'v': 1,
                  'value': 0},
                 {'blockHash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
                  'blockNumber': 93844884,
                  'hash': HexBytes('0x4b325bcffd991e0037b2dd8502d6fb2a57334429b97cca17a89b6fcf900562af'),
                  'chainId': '0xa4b1', 'from': '0x97Cd9464F9a77d16b6a4214beB02874a113a14d5', 'gas': 921421,
                  'gasPrice': 215000000,
                  'input': HexBytes('0x095ea7b30000000000000000000000001111111254eeb25477b68fb85ed929f73a960582ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'),
                  'nonce': 4, 'r': HexBytes('0x454e6831c9dc53542862c199d272d0ec4ffcd371f7d39afc697b59018d12690a'),
                  's': HexBytes('0x5c21520762517422ed64657fceea25530a8959a40ea04fe45b5725a5c1de89bb'),
                  'to': '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8', 'transactionIndex': 4, 'type': '0x0', 'v': 84357,
                  'value': 0}], 'difficulty': 1,
             'extraData': HexBytes('0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'),
             'gasLimit': 1125899906842624, 'gasUsed': 5584530, 'logsBloom': HexBytes(
                '0x000000004000000000050000800010000040000000440000210000000400001000000000000800000400020000080000040000000008b040000000080022800000001000100009004c00000801800000000100000800000100440200820000000200000002020080000002000400080002100060000200000020001200004000040000082000080400044000000200000000000008008020322200000000000002000420002001521000081000020400401402000010010000c0000400a000108000801600400002c6004000002050200080002002012000000a0038040a24000010008000000400440c20001000000110000010001000000000480100000080'),
             'miner': '0xA4b000000000000000000073657175656e636572',
             'mixHash': HexBytes('0x0000000000012c6600000000010863c6000000000000000a0000000000000000'),
             'nonce': HexBytes('0x00000000000d3ed6'),
             'parentHash': HexBytes('0xe95b37848c1c65e069653b7fe1106ad05f1f8ad674a4b032106f80d0a10a8722'),
             'receiptsRoot': HexBytes('0xda58a1f34def02ae79e21ef6ab094535167f45f25b877cbec168a9030e6f1b40'),
             'sha3Uncles': HexBytes('0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347'), 'size': 2993,
             'stateRoot': HexBytes('0xfecd0e131f749ba00bc214fe55bd08df2ed7ceb186620a910e90e8908f4f162c'),
             'timestamp': 1684906963, 'totalDifficulty': 71637068,
             'transactionsRoot': HexBytes('0x62f58372231f3e237fd8790c42aab1ecd539a37481d41440d1d159710059ef53'),
             'uncles': [], 'baseFeePerGas': 100000000, 'l1BlockNumber': '0x10863c6', 'sendCount': '0x12c66',
             'sendRoot': '0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'},
            {'number': 93844885, 'hash': HexBytes('0x56b96b2e26cd979d1722133e2e4afe4d259b571b2e9f203f311735aa296efdf1'),
             'transactions': [
                 {'blockHash': HexBytes('0x56b96b2e26cd979d1722133e2e4afe4d259b571b2e9f203f311735aa296efdf1'),
                  'blockNumber': 93844885,
                  'hash': HexBytes('0xa653ceac3d885c763639058ef68a52a98fef37f0ce3b3798c8dd50c869851c34'),
                  'chainId': '0xa4b1', 'from': '0x00000000000000000000000000000000000A4B05', 'gas': 0, 'gasPrice': 0,
                  'input': HexBytes('0x6bf6a42d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010863c7000000000000000000000000000000000000000000000000000000000597f5950000000000000000000000000000000000000000000000000000000000000000'),
                  'nonce': 0, 'r': HexBytes('0x00'), 's': HexBytes('0x00'),
                  'to': '0x00000000000000000000000000000000000A4B05', 'transactionIndex': 0, 'type': '0x6a', 'v': 0,
                  'value': 0},
                 {'blockHash': HexBytes('0x56b96b2e26cd979d1722133e2e4afe4d259b571b2e9f203f311735aa296efdf1'),
                  'blockNumber': 93844885,
                  'hash': HexBytes('0xede7cb95a6233567622ed415d9a10e937a2afe80da83dd37473ef5597dd4a852'),
                  'accessList': [], 'chainId': '0xa4b1', 'from': '0x62383739D68Dd0F844103Db8dFb05a7EdED5BBE6',
                  'gas': 3000000, 'gasPrice': 2100000000,
                  'input': HexBytes('0xa9059cbb000000000000000000000000b91f6c856635209f3f1da35bf8ba5ddeefb529a5000000000000000000000000000000000000000000000000000000003baa0c40'),
                  'maxFeePerGas': 10000000000, 'maxPriorityFeePerGas': 2000000000, 'nonce': 627325,
                  'r': HexBytes('0x7a3826f73816bad2213ec0985a26a328637b504494a4006ee89fcbcb820dccdd'),
                  's': HexBytes('0x7166fb5ad3c136dc74c421d16db2d5c32173b155e825699ec24bd3a5b9cf4d35'),
                  'to': '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', 'transactionIndex': 1, 'type': '0x2', 'v': 1,
                  'value': 0},
                 {'blockHash': HexBytes('0x56b96b2e26cd979d1722133e2e4afe4d259b571b2e9f203f311735aa296efdf1'),
                  'blockNumber': 93844885,
                  'hash': HexBytes('0x4851ba0f72dd5d47ec045b8a8cecced902dce0abdf901771a6c61a0af717c6b7'),
                  'chainId': '0xa4b1', 'from': '0x2A174b3AB8D4f0df3680272b11Ca7312BAA0A863', 'gas': 2000000,
                  'gasPrice': 100000000,
                  'input': HexBytes('0x1114cd2a000000000000000000000000000000000000000000000000000000000000006f0000000000000000000000002a174b3ab8d4f0df3680272b11ca7312baa0a86300000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000023cc335e33064000000000000000000000000000000000000000000000000000239e6130eda6400000000000000000000000000000000000000000000000000000000000000142a174b3ab8d4f0df3680272b11ca7312baa0a863000000000000000000000000'),
                  'nonce': 10, 'r': HexBytes('0xfd019704e9549b261daae18664d29d60beed4aa317b914aa0d1a0c150a8f90a6'),
                  's': HexBytes('0x2d658d2ee50050cc55112df3b5a726afe5e833d6dc9eed635b9f28c530c0c95c'),
                  'to': '0xbf22f0f184bCcbeA268dF387a49fF5238dD23E40', 'transactionIndex': 2, 'type': '0x0', 'v': 84357,
                  'value': 1450812067044744}], 'difficulty': 1,
             'extraData': HexBytes('0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'),
             'gasLimit': 1125899906842624, 'gasUsed': 1993873, 'logsBloom': HexBytes(
                '0x0000004000008000400000000000000000004000000000002000000000000010000000300000002000000000001c00000000000000000010004000000020000000401000000000000000008800000200000000000000400000000000800000000004000000000001108000000400000081000000008040000000001000000000000000040000000000000000000400000000000128000000000000a00000000012040000400002000000000400000000002000000000000100000000000000000000d002000008000000000000000000000000400000000000000000100010001010800040000000000000008000000010010000000000400000000008000040'),
             'miner': '0xA4b000000000000000000073657175656e636572',
             'mixHash': HexBytes('0x0000000000012c6600000000010863c7000000000000000a0000000000000000'),
             'nonce': HexBytes('0x00000000000d3ed6'),
             'parentHash': HexBytes('0xfd01699572424f5c81a9966338dfda5e083830112b1e56f8b22cd05ad6dabb9d'),
             'receiptsRoot': HexBytes('0x78349dc01e2ee3b1860e08de2e2a30c1ce195ca94109dff74926c3fd6a1033d7'),
             'sha3Uncles': HexBytes('0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347'), 'size': 1229,
             'stateRoot': HexBytes('0x99f5e6320c1a253c08db327df8d4901a06655b2034b42f224439b221745d7ba9'),
             'timestamp': 1684906963, 'totalDifficulty': 71637069,
             'transactionsRoot': HexBytes('0xc0e0b18210841bb35b1537d88f9a528bd8c2c0d1ef94e4d4b0a107da879876ce'),
             'uncles': [], 'baseFeePerGas': 100000000, 'l1BlockNumber': '0x10863c7', 'sendCount': '0x12c66',
             'sendRoot': '0xa68533d429485312588c3dc94d95aa1d1a3d7671ca7ab353a52d24f696edd43d'}]

        self.api.get_block_head = Mock(return_value=block_head_mock_response)
        self.api.get_block_txs = Mock(side_effect=block_txs_mock_responses)
        settings.USE_TESTNET_BLOCKCHAINS = False
        ArbitrumExplorerInterface.block_txs_apis[0] = self.api
        expected_txs_addresses = {
            'output_addresses': {
                '0xb91f6c856635209f3f1da35bf8ba5ddeefb529a5', '0xd888862600bf4bea4c0743a7806f32030d4dbe2c',
                '0x202e653fb198b3f6ae6f178af6425c075ddfc1ad', '0x49aa60c997f386838f1267d9b878236da9ad9d5f',
                '0xcca39e63ef650a3fb9b2a0e7e50bd5cfbc198880', '0xfc659535ec5f8989884e1fe074dc7887d138945b'
            },
            'input_addresses': {
                '0x1b5b4e441f5a22bfd91b7772c780463f66a74b35', '0x62383739d68dd0f844103db8dfb05a7eded5bbe6',
                '0xb38e8c17e38363af6ebdcb3dae12e0243582891d', '0xf92402bb795fd7cd08fb83839689db79099c8c9c'
            }
        }
        expected_txs_info = {'outgoing_txs': {'0x62383739d68dd0f844103db8dfb05a7eded5bbe6': {13: [
            {'tx_hash': '0xe72c8aead1e00ef2af669ad4a8e26f2e20b38e7281410bf317f2045071f5f442',
             'value': Decimal('35.000000'), 'contract_address': None, 'block_height': 93844881, 'symbol': 'USDT'},
            {'tx_hash': '0x275f1cc09f524528f1a2853b58fc34f5cc2a1e27e77e9c104b6e96cb1c127218',
             'value': Decimal('1262.808741'), 'contract_address': None, 'block_height': 93844883, 'symbol': 'USDT'},
            {'tx_hash': '0xede7cb95a6233567622ed415d9a10e937a2afe80da83dd37473ef5597dd4a852',
             'value': Decimal('1001.000000'), 'contract_address': None, 'block_height': 93844885, 'symbol': 'USDT'}]},
                                              '0xf92402bb795fd7cd08fb83839689db79099c8c9c': {11: [{
                                                                                                      'tx_hash': '0xda8b725a6b60b3da15ad669086faa39f946d28ddf03fd3db7eac27e6d329b0fa',
                                                                                                      'value': Decimal(
                                                                                                          '0.012442000000000000'),
                                                                                                      'contract_address': None,
                                                                                                      'block_height': 93844881,
                                                                                                      'symbol': 'ETH'}]},
                                              '0x1b5b4e441f5a22bfd91b7772c780463f66a74b35': {11: [{
                                                                                                      'tx_hash': '0x1573594194318decf7ab73fca06a081c62164fb1827ef8a98979bc9b34228c77',
                                                                                                      'value': Decimal(
                                                                                                          '0.008539100000000000'),
                                                                                                      'contract_address': None,
                                                                                                      'block_height': 93844882,
                                                                                                      'symbol': 'ETH'}]},
                                              '0xb38e8c17e38363af6ebdcb3dae12e0243582891d': {11: [{
                                                                                                      'tx_hash': '0xff2911e067f46cd31bc4a42fbfa6d01a21849d9ca5c515c479267fdddac9a27c',
                                                                                                      'value': Decimal(
                                                                                                          '0.029250000000000000'),
                                                                                                      'contract_address': None,
                                                                                                      'block_height': 93844883,
                                                                                                      'symbol': 'ETH'}]}}, 'incoming_txs': {
            '0x202e653fb198b3f6ae6f178af6425c075ddfc1ad': {13: [
                {'tx_hash': '0xe72c8aead1e00ef2af669ad4a8e26f2e20b38e7281410bf317f2045071f5f442',
                 'value': Decimal('35.000000'), 'contract_address': None, 'block_height': 93844881, 'symbol': 'USDT'}]},
            '0xcca39e63ef650a3fb9b2a0e7e50bd5cfbc198880': {11: [
                {'tx_hash': '0xda8b725a6b60b3da15ad669086faa39f946d28ddf03fd3db7eac27e6d329b0fa',
                 'value': Decimal('0.012442000000000000'), 'contract_address': None, 'block_height': 93844881,
                 'symbol': 'ETH'}]}, '0xfc659535ec5f8989884e1fe074dc7887d138945b': {11: [
                {'tx_hash': '0x1573594194318decf7ab73fca06a081c62164fb1827ef8a98979bc9b34228c77',
                 'value': Decimal('0.008539100000000000'), 'contract_address': None, 'block_height': 93844882,
                 'symbol': 'ETH'}]}, '0xd888862600bf4bea4c0743a7806f32030d4dbe2c': {13: [
                {'tx_hash': '0x275f1cc09f524528f1a2853b58fc34f5cc2a1e27e77e9c104b6e96cb1c127218',
                 'value': Decimal('1262.808741'), 'contract_address': None, 'block_height': 93844883,
                 'symbol': 'USDT'}]}, '0x49aa60c997f386838f1267d9b878236da9ad9d5f': {11: [
                {'tx_hash': '0xff2911e067f46cd31bc4a42fbfa6d01a21849d9ca5c515c479267fdddac9a27c',
                 'value': Decimal('0.029250000000000000'), 'contract_address': None, 'block_height': 93844883,
                 'symbol': 'ETH'}]}, '0xb91f6c856635209f3f1da35bf8ba5ddeefb529a5': {13: [
                {'tx_hash': '0xede7cb95a6233567622ed415d9a10e937a2afe80da83dd37473ef5597dd4a852',
                 'value': Decimal('1001.000000'), 'contract_address': None, 'block_height': 93844885,
                 'symbol': 'USDT'}]}}}
        txs_addresses, txs_info, _ = BlockchainExplorer.get_latest_block_addresses('ARB', None, None, True, True,
                                                                                   raise_error=True)
        print('#####################################')
        print(expected_txs_info)
        print('*************************************')
        print(txs_info)
        print('#####################################')
        assert BlockchainUtilsMixin.compare_dicts_without_order(expected_txs_info, txs_info)
        assert BlockchainUtilsMixin.compare_dicts_without_order(expected_txs_addresses, txs_addresses)

    def test_get_token_balance(self):
        balance_mock_responses = [577876204]
        self.api.get_token_balance = Mock(side_effect=balance_mock_responses)
        ArbitrumExplorerInterface.token_balance_apis[0] = self.api
        balances = BlockchainExplorer.get_wallets_balance({'ARB': self.addresses_for_usdt}, Currencies.usdt)
        expected_balances = [{'address': '0x2370854a6e5e71eb8e5c4198fb8c24b1968c9efa', 'balance': Decimal('577.876204'),
                              'received': Decimal('577.876204'), 'sent': Decimal('0'), 'rewarded': Decimal('0')}]
        for balance, expected_balance in zip(balances.get(Currencies.usdt), expected_balances):
            assert balance == expected_balance
